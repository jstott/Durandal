<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src\plugins\js\dialog.js - Durandal API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="Durandal API"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 2.0.0-pre</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/Activator.html">Activator</a></li>
            
                <li><a href="../classes/ActivatorModule.html">ActivatorModule</a></li>
            
                <li><a href="../classes/ActivatorSettings.html">ActivatorSettings</a></li>
            
                <li><a href="../classes/AppModule.html">AppModule</a></li>
            
                <li><a href="../classes/CompositionModule.html">CompositionModule</a></li>
            
                <li><a href="../classes/CompositionTransaction.html">CompositionTransaction</a></li>
            
                <li><a href="../classes/DialogContext.html">DialogContext</a></li>
            
                <li><a href="../classes/DialogModule.html">DialogModule</a></li>
            
                <li><a href="../classes/EntranceModule.html">EntranceModule</a></li>
            
                <li><a href="../classes/Events.html">Events</a></li>
            
                <li><a href="../classes/EventsModule.html">EventsModule</a></li>
            
                <li><a href="../classes/HistoryModule.html">HistoryModule</a></li>
            
                <li><a href="../classes/HistoryOptions.html">HistoryOptions</a></li>
            
                <li><a href="../classes/HTTPModule.html">HTTPModule</a></li>
            
                <li><a href="../classes/MessageBox.html">MessageBox</a></li>
            
                <li><a href="../classes/ObservableModule.html">ObservableModule</a></li>
            
                <li><a href="../classes/Router.html">Router</a></li>
            
                <li><a href="../classes/RouterModule.html">RouterModule</a></li>
            
                <li><a href="../classes/SerializerModule.html">SerializerModule</a></li>
            
                <li><a href="../classes/Subscription.html">Subscription</a></li>
            
                <li><a href="../classes/SystemModule.html">SystemModule</a></li>
            
                <li><a href="../classes/ViewEngineModule.html">ViewEngineModule</a></li>
            
                <li><a href="../classes/ViewLocatorModule.html">ViewLocatorModule</a></li>
            
                <li><a href="../classes/ViewModelBinderModule.html">ViewModelBinderModule</a></li>
            
                <li><a href="../classes/WidgetModule.html">WidgetModule</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/activator.html">activator</a></li>
            
                <li><a href="../modules/app.html">app</a></li>
            
                <li><a href="../modules/composition.html">composition</a></li>
            
                <li><a href="../modules/dialog.html">dialog</a></li>
            
                <li><a href="../modules/entrance.html">entrance</a></li>
            
                <li><a href="../modules/events.html">events</a></li>
            
                <li><a href="../modules/history.html">history</a></li>
            
                <li><a href="../modules/http.html">http</a></li>
            
                <li><a href="../modules/observable.html">observable</a></li>
            
                <li><a href="../modules/router.html">router</a></li>
            
                <li><a href="../modules/serializer.html">serializer</a></li>
            
                <li><a href="../modules/system.html">system</a></li>
            
                <li><a href="../modules/viewEngine.html">viewEngine</a></li>
            
                <li><a href="../modules/viewLocator.html">viewLocator</a></li>
            
                <li><a href="../modules/viewModelBinder.html">viewModelBinder</a></li>
            
                <li><a href="../modules/widget.html">widget</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src\plugins\js\dialog.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
ï»¿/**
 * The viewLocator module collaborates with the viewEngine module to provide views (literally dom sub-trees) to other parts of the framework as needed. The primary consumer of the viewLocator is the composition module.
 * @module dialog
 * @requires system
 * @requires app
 * @requires composition
 * @requires activator
 * @requires viewEngine
 * @requires jquery
 */
define([&#x27;durandal/system&#x27;, &#x27;durandal/app&#x27;, &#x27;durandal/composition&#x27;, &#x27;durandal/activator&#x27;, &#x27;durandal/viewEngine&#x27;, &#x27;jquery&#x27;], function (system, app, composition, activator, viewEngine, $) {
    var contexts = {},
        dialogCount = 0,
        dialog;

    /**
     * Models a message box&#x27;s message, title and options.
     * @class MessageBox
     */
    var MessageBox = function(message, title, options) {
        this.message = message;
        this.title = title || MessageBox.defaultTitle;
        this.options = options || MessageBox.defaultOptions;
    };

    /**
     * Selects an option and closes the message box, returning the selected option through the dialog system&#x27;s promise.
     * @method selectOption
     * @param {string} dialogResult The result to select.
     */
    MessageBox.prototype.selectOption = function (dialogResult) {
        dialog.close(this, dialogResult);
    };

    /**
     * Provides the view to the composition system.
     * @method getView
     * @return {DOMElement} The view of the message box.
     */
    MessageBox.prototype.getView = function(){
        return viewEngine.processMarkup(MessageBox.defaultViewMarkup);
    };

    /**
     * The title to be used for the message box if one is not provided.
     * @property {string} defaultTitle
     * @default Application
     * @static
     */
    MessageBox.defaultTitle = app.title || &#x27;Application&#x27;;

    /**
     * The options to display in the message box of none are specified.
     * @property {string[]} defaultOptions
     * @default [&#x27;Ok&#x27;]
     * @static
     */
    MessageBox.defaultOptions = [&#x27;Ok&#x27;];

    /**
     * The markup for the message box&#x27;s view.
     * @property {string} defaultViewMarkup
     * @static
     */
    MessageBox.defaultViewMarkup = [
        &#x27;&lt;div data-view=&quot;plugins/messageBox&quot; class=&quot;messageBox&quot;&gt;&#x27;,
            &#x27;&lt;div class=&quot;modal-header&quot;&gt;&#x27;,
                &#x27;&lt;h3 data-bind=&quot;text: title&quot;&gt;&lt;/h3&gt;&#x27;,
            &#x27;&lt;/div&gt;&#x27;,
            &#x27;&lt;div class=&quot;modal-body&quot;&gt;&#x27;,
                &#x27;&lt;p class=&quot;message&quot; data-bind=&quot;text: message&quot;&gt;&lt;/p&gt;&#x27;,
            &#x27;&lt;/div&gt;&#x27;,
            &#x27;&lt;div class=&quot;modal-footer&quot; data-bind=&quot;foreach: options&quot;&gt;&#x27;,
                &#x27;&lt;button class=&quot;btn&quot; data-bind=&quot;click: function () { $parent.selectOption($data); }, text: $data, css: { \&#x27;btn-primary\&#x27;: $index() == 0, autofocus: $index() == 0 }&quot;&gt;&lt;/button&gt;&#x27;,
            &#x27;&lt;/div&gt;&#x27;,
        &#x27;&lt;/div&gt;&#x27;
    ].join(&#x27;\n&#x27;);

    function ensureDialogInstance(objOrModuleId) {
        return system.defer(function(dfd) {
            if (system.isString(objOrModuleId)) {
                system.acquire(objOrModuleId).then(function (module) {
                    dfd.resolve(system.resolveObject(module));
                });
            } else {
                dfd.resolve(objOrModuleId);
            }
        }).promise();
    }

    /**
     * @class DialogModule
     * @static
     */
    dialog = {
        /**
         * The constructor function used to create message boxes.
         * @property {MessageBox} MessageBox
         */
        MessageBox:MessageBox,
        /**
         * The css zIndex that the last dialog was displayed at.
         * @property {int} currentZIndex
         */
        currentZIndex: 1050,
        /**
         * Gets the next css zIndex at which a dialog should be displayed.
         * @method getNextZIndex
         * @param {int} The zIndex.
         */
        getNextZIndex: function () {
            return ++this.currentZIndex;
        },
        /**
         * Determines whether or not there are any dialogs open.
         * @method isOpen
         * @return {boolean} True if a dialog is open. false otherwise.
         */
        isOpen: function() {
            return dialogCount &gt; 0;
        },
        /**
         * Gets the dialog context by name or returns the default context if no name is specified.
         * @method getContext
         * @param {string} [name] The name of the context to retrieve.
         * @return {DialogContext} True context.
         */
        getContext: function(name) {
            return contexts[name || &#x27;default&#x27;];
        },
        /**
         * Adds (or replaces) a dialog context.
         * @method addContext
         * @param {string} name The name of the context to add.
         * @param {DialogContext} dialogContext The context to add.
         */
        addContext: function(name, dialogContext) {
            dialogContext.name = name;
            contexts[name] = dialogContext;

            var helperName = &#x27;show&#x27; + name.substr(0, 1).toUpperCase() + name.substr(1);
            this[helperName] = function (obj, activationData) {
                return this.show(obj, activationData, name);
            };
        },
        createCompositionSettings: function(obj, dialogContext) {
            var settings = {
                model:obj,
                activate:false
            };

            if (dialogContext.attached) {
                settings.attached = dialogContext.attached;
            }

            if (dialogContext.compositionComplete) {
                settings.compositionComplete = dialogContext.compositionComplete;
            }

            return settings;
        },
        /**
         * Gets the dialog model that is associated with the specified object.
         * @method getDialog
         * @param {object} obj The object for whom to retrieve the dialog.
         * @return {Dialog} The dialog model.
         */
        getDialog:function(obj){
            if(obj){
                return obj.__dialog__;
            }

            return undefined;
        },
        /**
         * Closes the dialog associated with the specified object.
         * @method close
         * @param {object} obj The object whose dialog should be closed.
         * @param {object} result* The results to return back to the dialog caller after closing.
         */
        close:function(obj){
            var theDialog = this.getDialog(obj);
            if(theDialog){
                var rest = Array.prototype.slice.call(arguments, 1);
                theDialog.close.apply(theDialog, rest);
            }
        },
        /**
         * Shows a dialog.
         * @method show
         * @param {object|string} obj The object (or moduleId) to display as a dialog.
         * @param {object} [activationData] The data that should be passed to the object upon activation.
         * @param {string} [context] The name of the dialog context to use. Uses the default context if none is specified.
         * @return {Promise} A promise that resolves when the dialog is closed and returns any data passed at the time of closing.
         */
        show: function(obj, activationData, context) {
            var that = this;
            var dialogContext = contexts[context || &#x27;default&#x27;];

            return system.defer(function(dfd) {
                ensureDialogInstance(obj).then(function(instance) {
                    var dialogActivator = activator.create();

                    dialogActivator.activateItem(instance, activationData).then(function (success) {
                        if (success) {
                            var theDialog = instance.__dialog__ = {
                                owner: instance,
                                context: dialogContext,
                                activator: dialogActivator,
                                close: function () {
                                    var args = arguments;
                                    dialogActivator.deactivateItem(instance, true).then(function (closeSuccess) {
                                        if (closeSuccess) {
                                            dialogCount--;
                                            dialogContext.removeHost(theDialog);
                                            delete instance.__dialog__;

                                            if(args.length == 0){
                                                dfd.resolve();
                                            }else if(args.length == 1){
                                                dfd.resolve(args[0])
                                            }else{
                                                dfd.resolve.apply(dfd, args);
                                            }
                                        }
                                    });
                                }
                            };

                            theDialog.settings = that.createCompositionSettings(instance, dialogContext);
                            dialogContext.addHost(theDialog);

                            dialogCount++;
                            composition.compose(theDialog.host, theDialog.settings);
                        } else {
                            dfd.resolve(false);
                        }
                    });
                });
            }).promise();
        },
        /**
         * Shows a message box.
         * @method show
         * @param {string} message The message to display in the dialog.
         * @param {string} [title] The title message.
         * @param {string[]} [options] The options to provide to the user.
         * @return {Promise} A promise that resolves when the message box is closed and returns the selected option.
         */
        showMessage:function(message, title, options){
            if(system.isString(this.MessageBox)){
                return dialog.show(this.MessageBox, [
                    message,
                    title || MessageBox.defaultTitle,
                    options || MessageBox.defaultOptions
                ]);
            }

            return dialog.show(new this.MessageBox(message, title, options));
        },
        /**
         * Installs this module into Durandal. Adds &#x60;app.showDialog&#x60; and &#x60;app.showMessage&#x60; convenience methods.
         * @method install
         * @param {object} [config] Add a &#x60;messageBox&#x60; property to supply a custom message box constructor. Add a &#x60;messageBoxView&#x60; property to supply custom view markup for the built-in message box.
         */
        install:function(config){
            app.showDialog = function(obj, activationData, context) {
                return dialog.show(obj, activationData, context);
            };

            app.showMessage = function(message, title, options) {
                return dialog.showMessage(message, title, options);
            };

            if(config.messageBox){
                dialog.MessageBox = config.messageBox;
            }

            if(config.messageBoxView){
                dialog.MessageBox.prototype.getView = function(){
                    return config.messageBoxView;
                };
            }
        }
    };

    /**
     * @class DialogContext
     */
    dialog.addContext(&#x27;default&#x27;, {
        blockoutOpacity: .2,
        removeDelay: 200,
        /**
         * In this function, you are expected to add a DOM element to the tree which will serve as the &quot;host&quot; for the modal&#x27;s composed view. You must add a property called host to the modalWindow object which references the dom element. It is this host which is passed to the composition module.
         * @method addHost
         * @param {Dialog} theDialog The dialog model.
         */
        addHost: function(theDialog) {
            var body = $(&#x27;body&#x27;);
            var blockout = $(&#x27;&lt;div class=&quot;modalBlockout&quot;&gt;&lt;/div&gt;&#x27;)
                .css({ &#x27;z-index&#x27;: dialog.getNextZIndex(), &#x27;opacity&#x27;: this.blockoutOpacity })
                .appendTo(body);

            var host = $(&#x27;&lt;div class=&quot;modalHost&quot;&gt;&lt;/div&gt;&#x27;)
                .css({ &#x27;z-index&#x27;: dialog.getNextZIndex() })
                .appendTo(body);

            theDialog.host = host.get(0);
            theDialog.blockout = blockout.get(0);

            if (!dialog.isOpen()) {
                theDialog.oldBodyMarginRight = body.css(&quot;margin-right&quot;);
                theDialog.oldInlineMarginRight = body.get(0).style.marginRight;

                var html = $(&quot;html&quot;);
                var oldBodyOuterWidth = body.outerWidth(true);
                var oldScrollTop = html.scrollTop();
                $(&quot;html&quot;).css(&quot;overflow-y&quot;, &quot;hidden&quot;);
                var newBodyOuterWidth = $(&quot;body&quot;).outerWidth(true);
                body.css(&quot;margin-right&quot;, (newBodyOuterWidth - oldBodyOuterWidth + parseInt(theDialog.oldBodyMarginRight)) + &quot;px&quot;);
                html.scrollTop(oldScrollTop); // necessary for Firefox
            }
        },
        /**
         * This function is expected to remove any DOM machinery associated with the specified dialog and do any other necessary cleanup.
         * @method removeHost
         * @param {Dialog} theDialog The dialog model.
         */
        removeHost: function(theDialog) {
            $(theDialog.host).css(&#x27;opacity&#x27;, 0);
            $(theDialog.blockout).css(&#x27;opacity&#x27;, 0);

            setTimeout(function() {
                $(theDialog.host).remove();
                $(theDialog.blockout).remove();
            }, this.removeDelay);

            if (!dialog.isOpen()) {
                var html = $(&quot;html&quot;);
                var oldScrollTop = html.scrollTop(); // necessary for Firefox.
                html.css(&quot;overflow-y&quot;, &quot;&quot;).scrollTop(oldScrollTop);

                if(theDialog.oldInlineMarginRight) {
                    $(&quot;body&quot;).css(&quot;margin-right&quot;, theDialog.oldBodyMarginRight);
                } else {
                    $(&quot;body&quot;).css(&quot;margin-right&quot;, &#x27;&#x27;);
                }
            }
        },
        /**
         * This function is called after the modal is fully composed into the DOM, allowing your implementation to do any final modifications, such as positioning or animation. You can obtain the original dialog object by using &#x60;getDialog&#x60; on context.model.
         * @method compositionComplete
         * @param {DOMElement} child The dialog view.
         * @param {DOMElement} parent The parent view.
         * @param {object} context The composition context.
         */
        compositionComplete: function (child, parent, context) {
            var $child = $(child);
            var width = $child.width();
            var height = $child.height();
            var theDialog = dialog.getDialog(context.model);

            $child.css({
                &#x27;margin-top&#x27;: (-height / 2).toString() + &#x27;px&#x27;,
                &#x27;margin-left&#x27;: (-width / 2).toString() + &#x27;px&#x27;
            });

            $(theDialog.host).css(&#x27;opacity&#x27;, 1);

            if ($(child).hasClass(&#x27;autoclose&#x27;)) {
                $(theDialog.blockout).click(function() {
                    theDialog.close();
                });
            }

            $(&#x27;.autofocus&#x27;, child).each(function() {
                $(this).focus();
            });
        }
    });

    return dialog;
});
    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
